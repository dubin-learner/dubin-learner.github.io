# å®‰è£…concorde

## ç®€ä»‹
concordeæ˜¯ä¸€ä¸ªTSPé—®é¢˜æ±‚è§£å™¨ï¼ˆsolverï¼‰ï¼Œæ‰€è°“TSPé—®é¢˜å°±æ˜¯æ—…è¡Œå•†é—®é¢˜ï¼ˆTravel Salesman Problemï¼‰ï¼Œæœ‰ä¸€å®šæ•°ç›®çš„åŸå¸‚ï¼Œè¦æ±‚ä¸é‡å¤è®¿é—®å®Œå…¶ä¸­æ¯ä¸€ä¸ªåŸå¸‚çš„æœ€çŸ­è·¯å¾„æ˜¯å“ªä¸€æ¡ã€‚

ä¸»è¦æ˜¯å› ä¸ºä¹‹å‰æœ‰åœ¨çœ‹ã€Šè¿·èŒ«çš„æ—…è¡Œå•†ã€‹è¿™æœ¬ä¹¦ï¼Œè®²äº†æ—…è¡Œå•†é—®é¢˜çš„èµ·æºã€åº”ç”¨ç­‰è¯¸å¤šå†…å®¹ï¼Œç›®å‰å¤§æ¦‚çœ‹åˆ°ç¬¬ä¸‰ç« ï¼Œè·ç¦»çœ‹å®Œä»ç„¶é¥é¥æ— æœŸã€‚

è¿™æœ¬ä¹¦ä¸­æåˆ°äº†concordeæ˜¯ä¸€ä¸ªæ€§èƒ½å¾ˆä¸é”™çš„æ±‚è§£å™¨ï¼Œç”±ä¸šå†…å¤§ä½¬å¼€å‘ï¼Œå…è´¹ç»™ç§‘ç ”äººå‘˜ä½¿ç”¨ï¼Œå¹¶ä¸”å¼€æ”¾äº†æºç ã€‚

ä¸»ç«™åœ°å€ï¼š[Travel Salesman Problem](https://www.math.uwaterloo.ca/tsp/index.html)

[ä¸‹è½½é¡µé¢](https://www.math.uwaterloo.ca/tsp/concorde/downloads/downloads.htm) 
å¯¹äºwindowsç³»ç»Ÿï¼Œæœ‰ä¸€ä¸ªå…·æœ‰å›¾å½¢åŒ–ç•Œé¢çš„å®‰è£…åŒ…ï¼Œå¾ˆæ–¹ä¾¿ï¼›é™¤æ­¤ä¹‹å¤–è¿˜æœ‰åŸºæœ¬æ”¯æŒå…¨å¹³å°çš„æºç å®‰è£…æ–¹æ¡ˆã€‚

![Concorde Windows GUI](https://www.math.uwaterloo.ca/tsp/concorde/gui/img/done.jpg)

PS: æœ¬æ¥å…¬å¸çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šè£…äº†å›¾å½¢åŒ–çš„concordeï¼Œç„¶è€Œå‰ä¸€é˜µå­æä¿å¯†ä¹‹ç±»çš„æ“ä½œï¼Œè¢«åˆ¤å®šä¸ºéç™½åå•è½¯ä»¶ç»™å¼ºåˆ¶å¸è½½äº†ã€‚ğŸ˜®â€ğŸ’¨

## æºç å®‰è£…

è€ƒè™‘åˆ°ç›®å‰å·²ç»æ˜¯ç”¨MacBook Airçš„æ—¶å€™æ¯”è¾ƒå¤šï¼Œè™½ç„¶ä¸çŸ¥é“åé¢ä¼šä¸ä¼šç”¨ï¼Œä½†è¿˜æ˜¯æƒ³è¦è¯•ç€è£…ä¸€ä¸‹çœ‹ã€‚

ç„¶è€Œç”±äºapple m1èŠ¯ç‰‡çš„é—®é¢˜ï¼Œç€å®è¸©äº†äº›å‘ï¼Œä»¥ä¸‹ä¸ºä¸€äº›è®°å½•ã€‚

### åŸç”Ÿç³»ç»Ÿå®‰è£…

ç†è®ºä¸Šè®²ï¼Œæºç å®‰è£…åªè¦é…ç½®å¥½gccï¼ŒæˆåŠŸç¼–è¯‘å°±èƒ½é¡ºåˆ©å®Œæˆï¼Œç„¶è€Œè¿˜æ˜¯é‡åˆ°äº†ä¸æ˜æ‰€ä»¥çš„é—®é¢˜ã€‚

ä¸‹è½½æœ€æ–°çš„æºç åŒ…ï¼š

Concorde-03.12.19     Dec 19, 2003 ANSI C Code as gzipped tar file

æŒ‰ç…§å®˜æ–¹çš„æ–¹æ³•[å®‰è£…å‚è€ƒæ–‡æ¡£](https://www.math.uwaterloo.ca/tsp/concorde/DOC/README.html)ï¼Œå…ˆè§£å‹ï¼š
```bash
gunzip co031219.tgz
tar xvf co031219.tar
cd concorde/
```
ç„¶åé…ç½®ç¼–è¯‘é€‰é¡¹è¿›è¡Œconfigureï¼ˆæœ€å¥½çš„å¦ä¸€ä¸ªç›®å½•ä¸‹ï¼‰ï¼Œæœ€åmakeå®‰è£…ï¼š
```bash
cd ../
mkdir concorde_build
cd concorde_build
CC="gcc" CFLAGS="-g -O3" ../concorde/configure --host=darwin
make
```
å¯¹äºmacoså®˜æ–¹æ–‡æ¡£ä¸­è¯´æ˜¯è¦æŒ‡å®šhostï¼Œå®æµ‹ä¸æŒ‡å®šå´æ˜¯ä¼šæŠ¥é”™ï¼Œè¯´æ— æ³•ç¡®å®šhostã€‚

ç„¶è€Œè¿™ç§åœ¨makeè¿‡ç¨‹ä¸­ä¼šç¼–è¯‘æŠ¥é”™ï¼Œå¤§æ¦‚æ˜¯`size_t`çš„ç±»å‹ä¸æ”¯æŒä¿®æ”¹ä¹‹ç±»çš„ï¼Œåæ­£æœ‰ç‚¹è«åå…¶å¦™ï¼Œå°è¯•å‡ æ¬¡æ— æœåæ”¾å¼ƒã€‚

> åœ¨stackoverflowä¸Šæœåˆ°äº†ä¸€ä¸ªç›¸å…³é—®é¢˜[concorde with apple silicon m1](https://stackoverflow.com/questions/67968517/concorde-with-apple-silicon-m1)ï¼Œçœ‹ç»“æœä¼¼ä¹æ˜¯èƒ½æ­£ç¡®å®‰è£…çš„ã€‚

### é€šè¿‡orbstackçš„ubuntuå®‰è£…

ä¹‹å‰æ¥è§¦äº†orbstackï¼Œæ˜¯ä¸€ç§ç±»ä¼¼dockerçš„æ–¹å¼ï¼Œå¯ä»¥æ¨¡æ‹Ÿubuntuç¯å¢ƒã€‚è€ƒè™‘åˆ°è¿˜æ˜¯ubuntuæ›´é€šç”¨ä¸€äº›ï¼Œè¿™æ¬¡æ¢æˆäº†ubuntuè¿›è¡Œå°è¯•ï¼Œä½†ä»ç„¶æ˜¯apple m1æ¶æ„ï¼Œå³arm64ã€‚

æ–¹æ³•ä¸Šæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»ç„¶éœ€è¦æŒ‡å®šhostï¼Œè¿™é‡Œä¹Ÿæ˜¯æŒ‡å®šhostä¸ºdarwinï¼›åˆæœŸç¼–è¯‘é¡ºåˆ©ï¼Œä½†æœ€ååœ¨UTILæ¨¡å—ç¼–è¯‘æ—¶æŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š
```bash
../../concorde/UTIL/safe_io.c:1251:49: error: â€˜struct hostentâ€™ has no member named â€˜h_addrâ€™
 1251 |     memcpy ((void *) &hsock.sin_addr, (void *) h->h_addr, h->h_length);
      |                                                 ^~
```
è¿˜æ˜¯æ²¡æœ‰ææ¸…æ¥šåŸå› ã€‚

### é€šè¿‡orbstackçš„intelæ¶æ„ubuntuå®‰è£…

å‘ç°orbstackæ˜¯æ”¯æŒæ¨¡æ‹Ÿä¸åŒçš„æ¶æ„å®‰è£…ubuntuçš„ï¼Œæœæ–­é€‰æ‹©intel amd64ç‰ˆæœ¬åˆå®‰è£…äº†ä¸€ä¸ªubuntuå®¹å™¨ã€‚

å®‰è£…æ–¹æ³•å’Œä¸Šé¢æ²¡æœ‰åŒºåˆ«ï¼Œè¿™æ¬¡ä¸éœ€è¦æŒ‡å®šhostå°±èƒ½ç”¨ã€‚æ³¨æ„ç¼–è¯‘å®‰è£…ç›®å½•æœ€å¥½ä¸åœ¨åŸå§‹çš„ç›®å½•ä¹‹ä¸‹ï¼Œä¼¼ä¹ç›´æ¥åœ¨åŸå§‹ç›®å½•ä¸‹å®‰è£…ç¡®å®ä¼šæœ‰é—®é¢˜ã€‚

configureæ¯”è¾ƒé¡ºåˆ©ï¼Œä½†makeæ—¶ä¼šæŠ¥é”™ï¼š
```
/usr/bin/ld: ../LP/lp.a(lpqsopt.o): in function `CClp_tune_small':
/home/dubin/build/LP/../../concorde/LP/lpqsopt.c:355: undefined reference to `QSset_param'
/usr/bin/ld: /home/dubin/build/LP/../../concorde/LP/lpqsopt.c:361: undefined reference to `QSset_param'
/usr/bin/ld: /home/dubin/build/LP/../../concorde/LP/lpqsopt.c:367: undefined reference to `QSset_param'
/usr/bin/ld: /home/dubin/build/LP/../../concorde/LP/lpqsopt.c:373: undefined reference to `QSset_param'
/usr/bin/ld: ../LP/lp.a(lpqsopt.o): in function `CClp_free':
......
```
æ€»ä¹‹å°±æ˜¯æç¤ºlink errorã€‚æŸ¥äº†ä¸€ä¸‹éœ€è¦æŒ‡å®šqsoptç¼–è¯‘å¥½çš„.hå’Œ.aæ–‡ä»¶ï¼Œå…·ä½“è§[qsoptç›¸å…³é¡µé¢](https://www.math.uwaterloo.ca/~bico/qsopt/downloads/downloads.htm)ï¼Œæœ€ç»ˆé€‰æ‹©çš„qsoptç¼–è¯‘ç‰ˆæœ¬ä¸ºï¼š
```
Ubuntu 18 (with -fPIC)
- qsopt      Solver Executable
- qsopt.a    Function Library (170311)
- qsopt.h    C include file
```

ç»™configureå‘½ä»¤æ·»åŠ `--with=qsopt`å‚æ•°å¦‚ä¸‹ï¼š
```bash
CC="gcc" CFLAGS="-g -O3" ../concorde/configure --with-qsopt=/home/dubin/concorde_build/QSOPT/
make
```

å°±å¯ä»¥æˆåŠŸç¼–è¯‘ï¼Œä»¥ä¸Šæåˆ°çš„å‡ ä¸ªç¼–è¯‘æŠ¥é”™éƒ½æ²¡æœ‰ã€‚æœ€ç»ˆæˆåŠŸç”Ÿæˆäº†./TSP/concordeå¯æ‰§è¡Œæ–‡ä»¶ã€‚

é€šè¿‡å‘½ä»¤æµ‹è¯•è¿è¡Œæ•ˆæœï¼š
```bash
$ ./TSP/concorde -s 99 -k 100
./TSP/concorde -s 99 -k 100
Host: ubuntu-20-intel  Current process id: 5413
Using random seed 99
Random 100 point set
XSet initial upperbound to 780 (from tour)
  LP Value  1: 738.500000  (0.02 seconds)
  LP Value  2: 765.000000  (0.02 seconds)
  LP Value  3: 774.660000  (0.04 seconds)
  LP Value  4: 778.000000  (0.06 seconds)
  LP Value  5: 778.465517  (0.07 seconds)
  LP Value  6: 778.705882  (0.09 seconds)
  LP Value  7: 779.538462  (0.11 seconds)
  LP Value  8: 779.937500  (0.13 seconds)
  LP Value  9: 780.000000  (0.14 seconds)
New lower bound: 780.000000
Final lower bound 780.000000, upper bound 780.000000
Exact lower bound: 780.000000
DIFF: 0.000000
Final LP has 180 rows, 336 columns, 2921 nonzeros
Optimal Solution: 780.00
Number of bbnodes: 1
Total Running Time: 0.22 (seconds)
```
